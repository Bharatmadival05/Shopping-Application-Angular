{"ast":null,"code":"import { __decorate, __metadata } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CustomerService } from '../customer.service';\nimport { DataService } from '../data.service';\nimport { Customer } from './customer';\nimport { Customers } from './customers';\nexport let CurrentcustomerComponent = class CurrentcustomerComponent {\n  constructor(dataService, customerService) {\n    this.dataService = dataService;\n    this.customerService = customerService;\n    this.custobj = new Customers();\n    this.customerObj = new Customer();\n    this.showEditForm = false;\n  }\n  ngOnInit() {\n    this.dataService.data$.subscribe(newData => {\n      this.logedInUsername = newData;\n      console.log(\"Welcome \" + this.logedInUsername);\n      this.logedUser();\n    });\n  }\n  logedUser() {\n    // Ensure this method is called when the loggedInUsername changes\n    console.log('Data:', this.logedInUsername); // Log the value of this.data\n    if (this.logedInUsername !== null && this.logedInUsername !== undefined) {\n      this.currentcustomer = this.customerService.currentCustomer(this.logedInUsername);\n      this.currentcustomer.subscribe(customerData => {\n        console.log('Backend customer:', customerData);\n        // if (customerData && customerData.custimgString) {\n        //   if (customerData.custimgString) {\n        //     const base64String = customerData.custimgString.split(',')[1];\n        //     const decodedData = atob(base64String);\n        //     const uint8Array = new Uint8Array(decodedData.length);\n        //     for (let i = 0; i < decodedData.length; ++i) {\n        //       uint8Array[i] = decodedData.charCodeAt(i);\n        //     }\n        //     let imageType = '';\n        //     if (uint8Array.length > 1) {\n        //       if (uint8Array[0] === 0xFF && uint8Array[1] === 0xD8) {\n        //         imageType = 'jpeg';\n        //       } else if (\n        //         uint8Array[0] === 0x89 &&\n        //         uint8Array[1] === 0x50 &&\n        //         uint8Array[2] === 0x4E &&\n        //         uint8Array[3] === 0x47\n        //       ) {\n        //         imageType = 'png';\n        //       } else if (\n        //         uint8Array[0] === 0x47 &&\n        //         uint8Array[1] === 0x49 &&\n        //         uint8Array[2] === 0x46 &&\n        //         uint8Array[3] === 0x38\n        //       ) {\n        //         imageType = 'gif';\n        //       }\n        //     }\n        const dataURL = \"data:image/png;base64,W0JAM2M4MTg1MTZbQkAzZjhhZjQ1MFtCQDI0MTVkZjMxW0JANjIzNWY3YzNbQkA1NjVlMDM2MltCQDViNTdmNjI3W0JANTY5NDE1ZjVbQkBmOWJhNTUyW0JANGNiNTcyOWNbQkA3ZDViNWE3N1tCQDRjOWUyZGE4W0JAMzE0ZDBkZDFbQkA1ODk5ZjdkOVtCQDU1OTAwMzNkW0JAMzU3MjlmMjBbQkA2Y2YyMDVmNVtCQDJhZDIzNWMzW0JAMTVjNWFkMVtCQDdjMDdiODE4W0JANDI3Mjk1N2E=\";\n        console.log('Image Data URL:', dataURL);\n        // Do something with the data URL, e.g., assign it to an image source\n        this.customerObj.custimgString = dataURL;\n        //     } else {\n        //       console.warn('CustimgString is undefined');\n        //     }\n      });\n    } else {\n      // Handle the case where data is null (e.g., after logout)\n      this.currentcustomer = null;\n    }\n  }\n  // updateUser(){\n  //   this.customerService.updateCustomer(this.customerObj)\n  //   .subscribe((data)=>{\n  //     console.log(\"Customer updated successfully:\",data);\n  //     alert(\"Customer Updated\");\n  //   },\n  //   (error)=>{\n  //     console.log(\"Error during updation:\",error);\n  //     alert(\"Error during updation\");\n  //   }\n  //   );\n  // }\n  toggleEditForm() {\n    this.showEditForm = !this.showEditForm;\n  }\n  onImageChange(event) {\n    this.selectedImage = event.target.files[0];\n  }\n  updateUser() {\n    if (this.selectedImage !== null || this.selectedImage === null) {\n      const formData = new FormData();\n      this.custobj.custimg = this.selectedImage;\n      const custmerid = String(this.custobj.custmerid);\n      const pincode = String(this.custobj.pincode);\n      const contact = String(this.custobj.contactNo);\n      // Add other customer details to the FormData if needed\n      if (custmerid !== undefined && custmerid !== null && custmerid !== '') {\n        formData.append('custmerid', custmerid);\n      }\n      if (this.custobj.customerName !== undefined && this.custobj.customerName !== null && this.custobj.customerName !== '') {\n        formData.append('customerName', this.custobj.customerName);\n      }\n      if (this.custobj.gender !== undefined && this.custobj.gender !== null && this.custobj.gender !== '') {\n        formData.append('gender', this.custobj.gender);\n      }\n      if (contact !== undefined && contact !== null && contact !== '') {\n        formData.append('contactNo', contact);\n      }\n      if (this.custobj.email !== undefined && this.custobj.email !== null && this.custobj.email !== '') {\n        formData.append('email', this.custobj.email);\n      }\n      if (this.custobj.address !== undefined && this.custobj.address !== null && this.custobj.address !== '') {\n        formData.append('address', this.custobj.address);\n      }\n      if (pincode !== undefined && pincode !== null && pincode !== '') {\n        formData.append('pincode', pincode);\n      }\n      if (this.custobj.username !== undefined && this.custobj.username !== null && this.custobj.username !== '') {\n        formData.append('username', this.custobj.username);\n      }\n      if (this.custobj.password !== undefined && this.custobj.password !== null && this.custobj.password !== '') {\n        formData.append('password', this.custobj.password);\n      }\n      if (this.custobj.custimg !== undefined && this.custobj.custimg !== null) {\n        formData.append('file', this.custobj.custimg);\n      }\n      // Add more fields as needed\n      // Call your service to upload the image along with other details\n      this.customerService.updateCustomer(formData).subscribe(response => {\n        console.log('Image uploaded successfully:', response);\n        // Update other customer details if needed\n        this.updateUser();\n      }, error => {\n        console.error('Error uploading image:', error);\n        try {\n          const errorJson = JSON.parse(error.error);\n          console.error('Server error:', errorJson);\n        } catch (e) {\n          console.error('Non-JSON response:', error.error);\n        }\n        // Handle error as needed\n      });\n    }\n  }\n};\n\nCurrentcustomerComponent = __decorate([Component({\n  selector: 'currentcustomer',\n  templateUrl: './currentcustomer.component.html',\n  styleUrls: ['./currentcustomer.component.css']\n}), __metadata(\"design:paramtypes\", [DataService, CustomerService])], CurrentcustomerComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}